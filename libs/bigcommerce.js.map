{"version":3,"file":"bigcommerce.js","names":["BigCommerce","config","Error","client_id","secret","store_hash","response_type","headers","request_timeout","request_throttle_interval","request_debounce_interval","request_concurrency","request_max_count","reporter","request","url","method","body","fullPath","endpointUrl","URL","REQUEST_BIGCOMMERCE_API_URL","Request","run","data","meta","pagination","totalPages","total_pages","currentPage","current_page","promises","nextPage","searchParams","set","pathname","search","push","Promise","allSettled","then","res","filter","subItem","status","map","subItemData","value","concat","catch","err","error","message","convertObjectToString","reject","get","results","post"],"sources":["../src/libs/bigcommerce.js"],"sourcesContent":["\"use strict\";\n\nimport { REQUEST_BIGCOMMERCE_API_URL } from \"../constants\";\nimport { convertObjectToString } from \"../utils/convertValues\";\nimport { Request } from \"./request\";\n\nexport class BigCommerce {\n\tconstructor(config) {\n\t\tif (!config) {\n\t\t\tthrow new Error(\"BigCommerce API config required. It is required to make any call to the API\");\n\t\t}\n\n\t\tthis.client_id = config.client_id;\n\t\tthis.secret = config.secret;\n\t\tthis.store_hash = config.store_hash;\n\t\tthis.response_type = config.response_type;\n\t\tthis.headers = config.headers;\n\t\tthis.request_timeout = config.request_timeout;\n\t\tthis.request_throttle_interval = config.request_throttle_interval;\n\t\tthis.request_debounce_interval = config.request_debounce_interval;\n\t\tthis.request_concurrency = config.request_concurrency;\n\t\tthis.request_max_count = config.request_max_count;\n\t\tthis.reporter = config.reporter;\n\t}\n\n\t// Handle API requests\n\tasync request({ url, method = \"\", body, headers }) {\n\t\t// Update full path\n\t\tlet fullPath = `/stores/${this.store_hash + url}`;\n\t\tlet endpointUrl = new URL(fullPath, REQUEST_BIGCOMMERCE_API_URL);\n\n\t\t// Prepare `url` for request execution\n\t\tconst request = new Request(REQUEST_BIGCOMMERCE_API_URL, {\n\t\t\theaders: {\n\t\t\t\t...this.headers,\n\t\t\t\t...headers\n\t\t\t},\n\t\t\tresponse_type: this.response_type,\n\t\t\trequest_timeout: this.request_timeout,\n\t\t\trequest_throttle_interval: this.request_throttle_interval,\n\t\t\trequest_debounce_interval: this.request_debounce_interval,\n\t\t\trequest_max_count: this.request_max_count,\n\t\t\trequest_concurrency: this.request_concurrency\n\t\t});\n\n\t\t// Run request\n\t\tconst { data } = await request.run({ url: fullPath, method, body, headers, reporter: this.reporter });\n\n\t\t// If response contains pagination, run request again for each page\n\t\tif (\"meta\" in data) {\n\t\t\tif (\"pagination\" in data.meta) {\n\t\t\t\tconst { total_pages: totalPages, current_page: currentPage } = data.meta.pagination;\n\n\t\t\t\t// If current page is not the last page.\n\t\t\t\tif (totalPages > currentPage) {\n\t\t\t\t\t// Collect all page request promises in array.\n\t\t\t\t\tconst promises = [];\n\n\t\t\t\t\tfor (let nextPage = currentPage + 1; nextPage <= totalPages; nextPage++) {\n\t\t\t\t\t\t// Safely assign `page` query parameter to endpoint URL.\n\t\t\t\t\t\tendpointUrl.searchParams.set(\"page\", nextPage);\n\n\t\t\t\t\t\t// Add promise to array for future Promise.allSettled() call.\n\t\t\t\t\t\tpromises.push(await request.run({ url: `${endpointUrl.pathname}${endpointUrl.search}`, method: \"get\", body, headers, reporter: this.reporter }));\n\t\t\t\t\t}\n\n\t\t\t\t\t// Request all endpoints in parallel.\n\t\t\t\t\tawait Promise.allSettled(promises)\n\t\t\t\t\t\t.then((res) => {\n\t\t\t\t\t\t\tres\n\t\t\t\t\t\t\t\t?.filter((subItem) => subItem?.status === \"fulfilled\")\n\t\t\t\t\t\t\t\t?.map((subItem) => {\n\t\t\t\t\t\t\t\t\tconst subItemData = subItem?.value?.data?.data || null;\n\n\t\t\t\t\t\t\t\t\t// Update the item object with the subItem data\n\t\t\t\t\t\t\t\t\tdata.data = data.data.concat(subItemData);\n\n\t\t\t\t\t\t\t\t\t// Return the updated item object\n\t\t\t\t\t\t\t\t\treturn data.data;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\t\tthis.reporter.error(`[ERROR] ${err?.message || convertObjectToString(err) || \"There was an error while fetching and expanding items. Please try again later.\"}`);\n\t\t\t\t\t\t\treturn Promise.reject(err);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t// Set pager to last page.\n\t\t\t\t\tdata.meta.pagination.total_pages = totalPages;\n\t\t\t\t\tdata.meta.pagination.current_page = totalPages;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Return data\n\t\treturn \"data\" in data ? data.data : data;\n\t}\n\n\t/**\n\t * @description Handle `GET` requests\n\t * @param {String} url\n\t * @param {Object} body\n\t * @param {Object} headers\n\t * @param {String} endpoint\n\t * @returns {Promise} Response promise\n\t */\n\tasync get({ url, body, headers }) {\n\t\tconst results = await this.request({ url, method: \"get\", body, headers });\n\t\treturn results;\n\t}\n\n\t/**\n\t * @description Handle `POST` requests\n\t * @param {String} url\n\t * @param {Object} body\n\t * @param {Object} headers\n\t * @returns {Promise} Response promise\n\t */\n\tasync post({ url, body, headers }) {\n\t\tconst results = await this.request({ url, method: \"post\", body, headers });\n\t\treturn results;\n\t}\n}\n"],"mappings":"AAAA,YAAY,CAAC,gfAMAA,WAAW,YACvB,qBAAYC,MAAM,CAAE,CACnB,GAAI,CAACA,MAAM,CACV,KAAM,IAAIC,MAAK,CAAC,6EAA6E,CAAC,CAG/F,IAAI,CAACC,SAAS,CAAGF,MAAM,CAACE,SAAS,CACjC,IAAI,CAACC,MAAM,CAAGH,MAAM,CAACG,MAAM,CAC3B,IAAI,CAACC,UAAU,CAAGJ,MAAM,CAACI,UAAU,CACnC,IAAI,CAACC,aAAa,CAAGL,MAAM,CAACK,aAAa,CACzC,IAAI,CAACC,OAAO,CAAGN,MAAM,CAACM,OAAO,CAC7B,IAAI,CAACC,eAAe,CAAGP,MAAM,CAACO,eAAe,CAC7C,IAAI,CAACC,yBAAyB,CAAGR,MAAM,CAACQ,yBAAyB,CACjE,IAAI,CAACC,yBAAyB,CAAGT,MAAM,CAACS,yBAAyB,CACjE,IAAI,CAACC,mBAAmB,CAAGV,MAAM,CAACU,mBAAmB,CACrD,IAAI,CAACC,iBAAiB,CAAGX,MAAM,CAACW,iBAAiB,CACjD,IAAI,CAACC,QAAQ,CAAGZ,MAAM,CAACY,QACxB,CAAC,+CAGKC,OAAO,2IAAb,0SAAgBC,IAAG,MAAHA,GAAG,kBAAEC,MAAM,CAANA,MAAM,sBAAG,EAAE,aAAEC,IAAI,MAAJA,IAAI,CAAEV,OAAO,MAAPA,OAAO,CAE1CW,QAAQ,aAAc,IAAI,CAACb,UAAU,CAAGU,GAAG,EAC3CI,WAAW,CAAG,GAAIC,IAAG,CAACF,QAAQ,CAAEG,sCAA2B,CAAC,CAG1DP,OAAO,CAAG,GAAIQ,kBAAO,CAACD,sCAA2B,CAAE,CACxDd,OAAO,0BACH,IAAI,CAACA,OAAO,CACZA,OAAO,CACV,CACDD,aAAa,CAAE,IAAI,CAACA,aAAa,CACjCE,eAAe,CAAE,IAAI,CAACA,eAAe,CACrCC,yBAAyB,CAAE,IAAI,CAACA,yBAAyB,CACzDC,yBAAyB,CAAE,IAAI,CAACA,yBAAyB,CACzDE,iBAAiB,CAAE,IAAI,CAACA,iBAAiB,CACzCD,mBAAmB,CAAE,IAAI,CAACA,mBAC3B,CAAC,CAAC,iBAGqBG,OAAO,CAACS,GAAG,CAAC,CAAER,GAAG,CAAEG,QAAQ,CAAEF,MAAM,CAANA,MAAM,CAAEC,IAAI,CAAJA,IAAI,CAAEV,OAAO,CAAPA,OAAO,CAAEM,QAAQ,CAAE,IAAI,CAACA,QAAS,CAAC,CAAC,4CAA7FW,IAAI,oBAAJA,IAAI,GAGR,MAAM,EAAIA,KAAI,+BACb,YAAY,EAAIA,KAAI,CAACC,IAAI,mDACmCD,IAAI,CAACC,IAAI,CAACC,UAAU,CAA9DC,UAAU,uBAAvBC,WAAW,CAA4BC,WAAW,uBAAzBC,YAAY,GAGzCH,UAAU,CAAGE,WAAW,0BAErBE,QAAQ,CAAG,EAAE,CAEVC,QAAQ,CAAGH,WAAW,CAAG,CAAC,cAAEG,QAAQ,EAAIL,UAAU,gCAE1DR,YAAW,CAACc,YAAY,CAACC,GAAG,CAAC,MAAM,CAAEF,QAAQ,CAAC,aAG9CD,QAAQ,kBAAYjB,OAAO,CAACS,GAAG,CAAC,CAAER,GAAG,IAAKI,WAAW,CAACgB,QAAQ,CAAGhB,WAAW,CAACiB,MAAQ,CAAEpB,MAAM,CAAE,KAAK,CAAEC,IAAI,CAAJA,IAAI,CAAEV,OAAO,CAAPA,OAAO,CAAEM,QAAQ,CAAE,IAAI,CAACA,QAAS,CAAC,CAAC,+CAAtIwB,IAAI,uCAL+CL,QAAQ,EAAE,wDASjEM,OAAO,CAACC,UAAU,CAACR,QAAQ,CAAC,CAChCS,IAAI,CAAC,SAACC,GAAG,CAAK,wBACdA,GAAG,WAAHA,GAAG,sBAAHA,GAAG,CACAC,MAAM,CAAC,SAACC,OAAO,QAAyB,WAAW,WAA/BA,OAAO,WAAPA,OAAO,QAAPA,OAAO,CAAEC,MAAM,CAAgB,EAAC,+BADvD,YAEGC,GAAG,CAAC,SAACF,OAAO,CAAK,wCACZG,WAAW,CAAG,QAAAH,OAAO,WAAPA,OAAO,yBAAPA,OAAO,CAAEI,KAAK,wDAAd,eAAgBvB,IAAI,uCAApB,oBAAsBA,IAAI,GAAI,IAAI,CAMtD,MAHAA,KAAI,CAACA,IAAI,CAAGA,IAAI,CAACA,IAAI,CAACwB,MAAM,CAACF,WAAW,CAAC,CAGlCtB,IAAI,CAACA,IACb,CAAC,CACH,CAAC,CAAC,CACDyB,KAAK,CAAC,SAACC,GAAG,CAAK,CAEf,MADA,MAAI,CAACrC,QAAQ,CAACsC,KAAK,aAAY,QAAAD,GAAG,WAAHA,GAAG,QAAHA,GAAG,CAAEE,OAAO,GAAI,GAAAC,oCAAqB,EAACH,GAAG,CAAC,EAAI,gFAAgF,EAAG,CACzJZ,OAAO,CAACgB,MAAM,CAACJ,GAAG,CAC1B,CAAC,CAAC,SAGH1B,IAAI,CAACC,IAAI,CAACC,UAAU,CAACE,WAAW,CAAGD,UAAU,CAC7CH,IAAI,CAACC,IAAI,CAACC,UAAU,CAACI,YAAY,CAAGH,UAAU,yCAM1C,MAAM,EAAIH,KAAI,CAAGA,IAAI,CAACA,IAAI,CAAGA,IAAI,4DACxC,4BAUK+B,GAAG,+HAAT,qKAAYxC,IAAG,OAAHA,GAAG,CAAEE,IAAI,OAAJA,IAAI,CAAEV,OAAO,OAAPA,OAAO,kBACP,IAAI,CAACO,OAAO,CAAC,CAAEC,GAAG,CAAHA,GAAG,CAAEC,MAAM,CAAE,KAAK,CAAEC,IAAI,CAAJA,IAAI,CAAEV,OAAO,CAAPA,OAAQ,CAAC,CAAC,cAAnEiD,QAAO,0CACNA,OAAO,6DACd,wBASKC,IAAI,kIAAV,qKAAa1C,IAAG,OAAHA,GAAG,CAAEE,IAAI,OAAJA,IAAI,CAAEV,OAAO,OAAPA,OAAO,kBACR,IAAI,CAACO,OAAO,CAAC,CAAEC,GAAG,CAAHA,GAAG,CAAEC,MAAM,CAAE,MAAM,CAAEC,IAAI,CAAJA,IAAI,CAAEV,OAAO,CAAPA,OAAQ,CAAC,CAAC,cAApEiD,QAAO,0CACNA,OAAO,6DACd"}